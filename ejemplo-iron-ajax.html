<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/image-icons.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-button/paper-button.html">

<dom-module id="ejemplo-iron-ajax">
  <template>
    <style>
      :host {
        display: block;
      }

      .wrapper-cards {
        display: inline-flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: flex-start;
      }

      .wrapper-cards>.card {
        width: 40%;
        margin: .25rem;
      }

      .card {}

      .card__header {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem .75rem .125rem .75rem;
      }

      .card__header-title {
        font-size: 1.1rem;
        font-weight: 500;
      }

      .card__header-eye-color {
        opacity: .5;
        position: absolute;
        top: -2.5px;
        right: -5px;
      }

      .card__header-eye-color.brown {
        color: brown;
      }

      .card__header-eye-color.blue {
        color: blue;
      }

      .card__header-eye-color.green {
        color: green;
      }


      .card__header-img {
        display: inline-block;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: 1px solid #a0a0a0;
        overflow: hidden;
        transform: scale(1.3);
        margin-right: 1rem;
      }

      .card__body {
        padding: .75rem;
      }

      .card__body-friend {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: .25rem;
        border: 1px solid #d2d2d2;
        margin-top: .5rem;
      }

      .card__body-btn-friends {
        display: flex;
        justify-content: flex-end;
        align-items: center;
      }

      .card__body-details-balance > label,
      .card__body-details-fruit > label{
        font-weight: 700;
      }


      paper-button {
        --paper-button: {
          padding: .5rem .25;
          font-size: .75rem;
        }

        ;
      }

      paper-button.indigo {
        background-color: var(--paper-indigo-500);
        color: white;
      }

      paper-button.indigo[active] {
        background-color: var(--paper-red-500);
      }
    </style>
    <iron-ajax auto url="http://demo6292426.mockable.io/persons" handle-as="json" last-response="{{persons}}">
    </iron-ajax>
    <div class="wrapper-cards">
      <template is="dom-repeat" items="{{persons}}" as="person">
        <paper-card class="card">
          <div class="card__header">
            <paper-icon-button icon="image:remove-red-eye" class$="card__header-eye-color {{person.eyeColor}}">
            </paper-icon-button>
            <h2 class="card__header-title">{{person.name.first}} {{person.name.last}}</h2>
            <div class="card__header-img"><img src="{{person.picture}}" alt="Imagen persona"></div>
          </div>
          <div class="card__body">
            <div class="card__body-details">
              <div class="card__body-details-balance">
                <label>Balance:</label>
                <span>{{_darFormatoCantidad(person.balance)}}</span>
              </div>
              <div class="card__body-details-fruit">
                <label>Fruta:</label>
                <span>{{person.favoriteFruit}}</span>
              </div>
            </div>
            <div class="card__body-btn-friends">
              <paper-button toggles raised class="indigo" on-click="toggle">Amigos</paper-button>
            </div>

            <iron-collapse id="collapse{{index}}">
              <div class="card__body-friends">
                <template is="dom-repeat" items="{{person.friends}}" as="friend">
                  <div class="card__body-friend">
                    <label>{{friend.name}}</label>
                  </div>
                </template>
              </div>
            </iron-collapse>
          </div>
        </paper-card>
      </template>
    </div>
  </template>

  <script>
    /**
     * `ejemplo-iron-ajax`
     * 
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class EjemploIronAjax extends Polymer.Element {
      static get is() { return 'ejemplo-iron-ajax'; }
      static get properties() {

        return {
          persons: {
            type: Array
          }
        };
      }
      toggle(e) {
        let ironCollapse = this.shadowRoot.querySelector(`#collapse${e.model.index}`);
        ironCollapse.toggle();
      }

      _darFormatoCantidad(cantidad) {
        return cantidad.replace('$', '').replace(',', '');
      }
    }

    window.customElements.define(EjemploIronAjax.is, EjemploIronAjax);
  </script>
</dom-module>